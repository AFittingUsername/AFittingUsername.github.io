<!DOCTYPE html>
<html>
<head>
  <title>Blog Solution</title>
  <style>
    /* CSS styling */
    /* ... */
  </style>
</head>
<body>
  <form id="messageForm">
    <input type="text" id="nameInput" placeholder="Your Name">
    <br />
    <textarea id="messageInput" rows="4" placeholder="Enter your message"></textarea>
    <br />
    <button type="submit">Post</button>
  </form>
  <div id="messageContainer"></div>

  <script>
    // Array to store posted messages
    var messages = [];

    // Function to display all messages
    function displayMessages() {
      var messageContainer = document.getElementById("messageContainer");
      messageContainer.innerHTML = ""; // Clear the container before displaying messages

      messages.forEach(function(message) {
        var messageElement = document.createElement("div");
        messageElement.textContent = message;
        messageContainer.appendChild(messageElement);
      });
    }

    // Function to store messages in a text file
    function storeMessages() {
      var textFileContent = messages.join("\n");

      // Create a blob with the text content
      var blob = new Blob([textFileContent], { type: "text/plain" });

      // Generate the file name with the current date and time
      var fileName = "Blog messages - " + getCurrentDateTime() + ".txt";

      // Create a temporary anchor element to download the file
      var downloadLink = document.createElement("a");
      downloadLink.href = URL.createObjectURL(blob);
      downloadLink.download = fileName;
      downloadLink.click();
    }

    // Function to get the current date and time in a specific format
    function getCurrentDateTime() {
      var currentDateTime = new Date();
      var year = currentDateTime.getFullYear();
      var month = (currentDateTime.getMonth() + 1).toString().padStart(2, "0");
      var day = currentDateTime.getDate().toString().padStart(2, "0");
      var hours = currentDateTime.getHours().toString().padStart(2, "0");
      var minutes = currentDateTime.getMinutes().toString().padStart(2, "0");
      var seconds = currentDateTime.getSeconds().toString().padStart(2, "0");

      return year + "-" + month + "-" + day + " " + hours + "-" + minutes + "-" + seconds;
    }

    // Function to retrieve and display the contents of text documents
    function retrieveTextDocuments() {
      fetchTextDocuments()
        .then(function(textDocuments) {
          Promise.all(textDocuments.map(fetchTextDocumentContent))
            .then(function(contents) {
              contents.forEach(function(content) {
                messages.push(content);
              });
              displayMessages();
            })
            .catch(function(error) {
              console.log("Error retrieving text document contents:", error);
            });
        })
        .catch(function(error) {
          console.log("Error retrieving text documents:", error);
        });
    }

    // Function to fetch the list of text documents matching the pattern
    function fetchTextDocuments() {
      return fetch("./") // Assuming the text documents are in the same directory as the HTML file
        .then(function(response) {
          return response.text();
        })
        .then(function(html) {
          var parser = new DOMParser();
          var doc = parser.parseFromString(html, "text/html");
          var links = doc.getElementsByTagName("a");
          var textDocuments = Array.from(links)
            .map(function(link) {
              return link.getAttribute("href");
            })
            .filter(function(href) {
              return href.startsWith("Blog messages") && href.endsWith(".txt");
            });
          return textDocuments;
        });
    }

    // Function to fetch the content of a text document
    function fetchTextDocumentContent(textDocument) {
      return fetch(textDocument)
        .then(function(response) {
          return response.text();
        });
    }

    // Event listener for form submission
    document.getElementById("messageForm").addEventListener("submit", function(event) {
      event.preventDefault(); // Prevent default form submission

      var nameInput = document.getElementById("nameInput");
      var messageInput = document.getElementById("messageInput");

      var name = nameInput.value.trim(); // Trim leading/trailing whitespace
      var message = messageInput.value.trim(); // Trim leading/trailing whitespace

      if (name !== "" && message !== "") {
        var timestamp = getCurrentDateTime();
        var formattedMessage = name + " - " + timestamp + " - " + message;
        messages.push(formattedMessage);
        displayMessages();
        nameInput.value = "";
        messageInput.value = "";
        storeMessages();
      }
    });

    // Call the function to retrieve and display the text documents on page load
    retrieveTextDocuments();
  </script>
</body>
</html>
