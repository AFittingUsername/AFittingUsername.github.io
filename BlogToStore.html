<!DOCTYPE html>
<html>
<head>
  <title>Message Board</title>
  <style>
    .message-table {
      width: 100%;
      border-collapse: collapse;
    }

    .message-table th,
    .message-table td {
      padding: 10px;
      border: 1px solid #ddd;
    }

    .message-img {
      max-width: 100px;
      max-height: 100px;
    }

    .form-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .form-label {
      width: 120px;
      text-align: right;
      margin-right: 10px;
      font-weight: bold;
    }

    .form-input {
      flex: 1;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .form-textarea {
      flex: 1;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .form-button {
      margin-left: 130px;
    }
  </style>
</head>
<body>
  <h1>Message Board</h1>

  <form id="messageForm">
    <div class="form-row">
      <label class="form-label" for="nameInput">Name:</label>
      <input class="form-input" type="text" id="nameInput" required>
    </div>

    <div class="form-row">
      <label class="form-label" for="messageInput">Message:</label>
      <textarea class="form-textarea" id="messageInput" rows="4" required></textarea>
    </div>

    <div class="form-row">
      <label class="form-label" for="replyAuthorInput">Reply Author:</label>
      <input class="form-input" type="text" id="replyAuthorInput">
    </div>

    <div class="form-row">
      <label class="form-label" for="replyMessageInput">Reply Message:</label>
      <textarea class="form-textarea" id="replyMessageInput" rows="4"></textarea>
    </div>

    <div class="form-row">
      <label class="form-label" for="pictureInput">Picture:</label>
      <input class="form-input" type="text" id="pictureInput">
    </div>

    <div class="form-row form-button">
      <button type="submit">Add Message</button>
    </div>
  </form>

  <br>

  <label for="nameFilterInput">Filter by Name:</label>
  <input type="text" id="nameFilterInput">

  <button id="filterButton">Filter</button>
  <button id="refreshButton">Refresh</button>

  <br><br>

  <table class="message-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Date</th>
        <th>Time</th>
        <th>Message</th>
        <th>Reply Author</th>
        <th>Reply Message</th>
        <th>Picture</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="messageTableBody"></tbody>
  </table>

  <br>

  <button id="downloadButton">Download CSV</button>

  <script>
    var allMessages = [];

    // Function to display messages
    function displayMessages(messages) {
      var tableBody = document.getElementById("messageTableBody");
      tableBody.innerHTML = "";

      messages.forEach(function(message, index) {
        var row = document.createElement("tr");

        var nameCell = document.createElement("td");
        nameCell.textContent = message.name;
        row.appendChild(nameCell);

        var dateCell = document.createElement("td");
        dateCell.textContent = new Date(message.timestamp).toLocaleDateString();
        row.appendChild(dateCell);

        var timeCell = document.createElement("td");
        timeCell.textContent = new Date(message.timestamp).toLocaleTimeString();
        row.appendChild(timeCell);

        var messageCell = document.createElement("td");
        messageCell.textContent = message.message;
        row.appendChild(messageCell);

        var replyAuthorCell = document.createElement("td");
        replyAuthorCell.textContent = message.replyAuthor;
        row.appendChild(replyAuthorCell);

        var replyMessageCell = document.createElement("td");
        replyMessageCell.textContent = message.replyMessage;
        row.appendChild(replyMessageCell);

        var pictureCell = document.createElement("td");
        if (message.picture) {
          var pictureImg = document.createElement("img");
          pictureImg.src = message.picture;
          pictureImg.alt = "Picture";
          pictureImg.classList.add("message-img");
          pictureCell.appendChild(pictureImg);
        }
        row.appendChild(pictureCell);

        var actionCell = document.createElement("td");
        var editButton = document.createElement("button");
        editButton.textContent = "Edit";
        editButton.addEventListener("click", function() {
          editMessage(index);
        });
        actionCell.appendChild(editButton);
        row.appendChild(actionCell);

        tableBody.appendChild(row);
      });
    }

    // Function to add a message
    function addMessage(name, message, replyAuthor, replyMessage, picture) {
      var newMessage = {
        name: name,
        message: message,
        replyAuthor: replyAuthor,
        replyMessage: replyMessage,
        picture: picture,
        timestamp: Date.now()
      };

      allMessages.push(newMessage);
      localStorage.setItem("messages", JSON.stringify(allMessages));
      displayMessages(allMessages);
    }

    // Function to edit a message
    function editMessage(index) {
      var message = allMessages[index];

      var nameInput = document.getElementById("nameInput");
      var messageInput = document.getElementById("messageInput");
      var replyAuthorInput = document.getElementById("replyAuthorInput");
      var replyMessageInput = document.getElementById("replyMessageInput");
      var pictureInput = document.getElementById("pictureInput");

      nameInput.value = message.name;
      messageInput.value = message.message;
      replyAuthorInput.value = message.replyAuthor;
      replyMessageInput.value = message.replyMessage;
      pictureInput.value = message.picture;

      var messageForm = document.getElementById("messageForm");
      messageForm.removeEventListener("submit", handleSubmit);
      messageForm.addEventListener("submit", function(event) {
        event.preventDefault();
        updateMessage(index);
      });
    }

    // Function to update a message
    function updateMessage(index) {
      var nameInput = document.getElementById("nameInput");
      var messageInput = document.getElementById("messageInput");
      var replyAuthorInput = document.getElementById("replyAuthorInput");
      var replyMessageInput = document.getElementById("replyMessageInput");
      var pictureInput = document.getElementById("pictureInput");

      var updatedMessage = {
        name: nameInput.value.trim(),
        message: messageInput.value.trim(),
        replyAuthor: replyAuthorInput.value.trim(),
        replyMessage: replyMessageInput.value.trim(),
        picture: pictureInput.value.trim(),
        timestamp: Date.now()
      };

      allMessages[index] = updatedMessage;
      localStorage.setItem("messages", JSON.stringify(allMessages));
      displayMessages(allMessages);

      var messageForm = document.getElementById("messageForm");
      messageForm.reset();
      messageForm.removeEventListener("submit", updateMessage);
      messageForm.addEventListener("submit", handleSubmit);
    }

    // Function to filter messages by name
    function filterMessages(name) {
      var filteredMessages = allMessages.filter(function(message) {
        return message.name.toLowerCase().includes(name.toLowerCase());
      });

      displayMessages(filteredMessages);
    }

    // Function to handle form submission
    function handleSubmit(event) {
      event.preventDefault();

      var nameInput = document.getElementById("nameInput");
      var messageInput = document.getElementById("messageInput");
      var replyAuthorInput = document.getElementById("replyAuthorInput");
      var replyMessageInput = document.getElementById("replyMessageInput");
      var pictureInput = document.getElementById("pictureInput");

      addMessage(
        nameInput.value.trim(),
        messageInput.value.trim(),
        replyAuthorInput.value.trim(),
        replyMessageInput.value.trim(),
        pictureInput.value.trim()
      );

      var messageForm = document.getElementById("messageForm");
      messageForm.reset();
    }

    // Function to download messages as CSV
    function downloadMessagesCSV() {
      var csvContent = "data:text/csv;charset=utf-8,";
      csvContent += "Name,Date,Time,Message,Reply Author,Reply Message,Picture\r\n";

      allMessages.forEach(function(message) {
        var row = [
          message.name,
          new Date(message.timestamp).toLocaleDateString(),
          new Date(message.timestamp).toLocaleTimeString(),
          message.message,
          message.replyAuthor,
          message.replyMessage,
          message.picture
        ];
        csvContent += row.join(",") + "\r\n";
      });

      var encodedURI = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedURI);
      link.setAttribute("download", "messages.csv");
      document.body.appendChild(link);
      link.click();
    }

    // Function to initialize the message board
    function initializeMessageBoard() {
      var storedMessages = localStorage.getItem("messages");

      if (storedMessages) {
        allMessages = JSON.parse(storedMessages);
      }

      displayMessages(allMessages);

      var messageForm = document.getElementById("messageForm");
      messageForm.addEventListener("submit", handleSubmit);

      var filterButton = document.getElementById("filterButton");
      filterButton.addEventListener("click", function() {
        var nameFilterInput = document.getElementById("nameFilterInput");
        filterMessages(nameFilterInput.value.trim());
      });

      var refreshButton = document.getElementById("refreshButton");
      refreshButton.addEventListener("click", function() {
        displayMessages(allMessages);
      });

      var downloadButton = document.getElementById("downloadButton");
      downloadButton.addEventListener("click", downloadMessagesCSV);
    }

    // Initialize the message board when the page loads
    window.onload = initializeMessageBoard;
  </script>
</body>
</html>
