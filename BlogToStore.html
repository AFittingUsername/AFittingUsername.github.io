<!DOCTYPE html>
<html>
<head>
  <style>
    /* Styles for the table and form */
    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
    }

    form {
      margin-bottom: 20px;
    }

    /* Styles for the message image */
    .message-img {
      max-width: 100px;
      max-height: 100px;
    }
  </style>
</head>
<body>
  <h1>Message Board</h1>

  <form id="messageForm">
    <label for="nameInput">Name:</label>
    <input type="text" id="nameInput" required>

    <label for="messageInput">Message:</label>
    <textarea id="messageInput" required></textarea>

    <label for="replyAuthorInput">Reply Author:</label>
    <input type="text" id="replyAuthorInput">

    <label for="replyMessageInput">Reply Message:</label>
    <textarea id="replyMessageInput"></textarea>

    <label for="pictureInput">Picture Link:</label>
    <input type="text" id="pictureInput">

    <button type="submit">Submit</button>
  </form>

  <label for="nameFilterInput">Filter by Name:</label>
  <input type="text" id="nameFilterInput">
  <button id="filterButton">Filter</button>

  <table id="messageTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Date</th>
        <th>Time</th>
        <th>Message</th>
        <th>Reply Author</th>
        <th>Reply Message</th>
        <th>Picture</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="messageTableBody"></tbody>
  </table>

  <button id="downloadButton">Download as CSV</button>

  <script>
    // Retrieve messages from local storage or use an empty array if none exists
    var allMessages = JSON.parse(localStorage.getItem("messages")) || [];

    // Function to display the messages in the table
    function displayMessages(messages) {
      var tableBody = document.getElementById("messageTableBody");
      tableBody.innerHTML = "";

      messages.forEach(function(message, index) {
        var row = document.createElement("tr");

        var nameCell = document.createElement("td");
        nameCell.textContent = message.name;
        row.appendChild(nameCell);

        var timestamp = new Date(message.timestamp);
        var dateCell = document.createElement("td");
        dateCell.textContent = timestamp.toLocaleDateString();
        row.appendChild(dateCell);

        var timeCell = document.createElement("td");
        timeCell.textContent = timestamp.toLocaleTimeString();
        row.appendChild(timeCell);

        var messageCell = document.createElement("td");
        messageCell.textContent = message.message;
        row.appendChild(messageCell);

        var replyAuthorCell = document.createElement("td");
        replyAuthorCell.textContent = message.replyAuthor;
        row.appendChild(replyAuthorCell);

        var replyMessageCell = document.createElement("td");
        replyMessageCell.textContent = message.replyMessage;
        row.appendChild(replyMessageCell);

        var pictureCell = document.createElement("td");
        if (message.picture) {
          var pictureImg = document.createElement("img");
          pictureImg.classList.add("message-img");
          pictureImg.src = message.picture;
          pictureCell.appendChild(pictureImg);
        }
        row.appendChild(pictureCell);

        var actionCell = document.createElement("td");
        var editLink = document.createElement("a");
        editLink.href = "#";
        editLink.textContent = "Edit";
        editLink.addEventListener("click", function(event) {
          event.preventDefault();
          editMessage(index);
        });
        actionCell.appendChild(editLink);
        row.appendChild(actionCell);

        tableBody.appendChild(row);
      });
    }

    // Function to add a new message
    function addMessage(name, message, replyAuthor, replyMessage, picture) {
      var newMessage = {
        name: name,
        message: message,
        replyAuthor: replyAuthor,
        replyMessage: replyMessage,
        picture: picture,
        timestamp: Date.now()
      };

      allMessages.push(newMessage);
      localStorage.setItem("messages", JSON.stringify(allMessages));
      displayMessages(allMessages);
    }

    // Function to edit an existing message
    function editMessage(index) {
      var message = allMessages[index];
      if (!message) return;

      var nameInput = document.getElementById("nameInput");
      var messageInput = document.getElementById("messageInput");
      var replyAuthorInput = document.getElementById("replyAuthorInput");
      var replyMessageInput = document.getElementById("replyMessageInput");
      var pictureInput = document.getElementById("pictureInput");

      nameInput.value = message.name;
      messageInput.value = message.message;
      replyAuthorInput.value = message.replyAuthor;
      replyMessageInput.value = message.replyMessage;
      pictureInput.value = message.picture;

      var messageForm = document.getElementById("messageForm");
      messageForm.addEventListener("submit", function(event) {
        event.preventDefault();

        var updatedName = nameInput.value.trim();
        var updatedMessage = messageInput.value.trim();
        var updatedReplyAuthor = replyAuthorInput.value.trim();
        var updatedReplyMessage = replyMessageInput.value.trim();
        var updatedPicture = pictureInput.value.trim();

        if (updatedName === "" || updatedMessage === "") {
          alert("Please enter your name and message.");
          return;
        }

        message.name = updatedName;
        message.message = updatedMessage;
        message.replyAuthor = updatedReplyAuthor;
        message.replyMessage = updatedReplyMessage;
        message.picture = updatedPicture;
        message.timestamp = Date.now();

        localStorage.setItem("messages", JSON.stringify(allMessages));
        displayMessages(allMessages);

        nameInput.value = "";
        messageInput.value = "";
        replyAuthorInput.value = "";
        replyMessageInput.value = "";
        pictureInput.value = "";
        messageForm.removeEventListener("submit", arguments.callee);
      });
    }

    // Event listener for the form submission
    var messageForm = document.getElementById("messageForm");
    messageForm.addEventListener("submit", function(event) {
      event.preventDefault();

      var nameInput = document.getElementById("nameInput");
      var messageInput = document.getElementById("messageInput");
      var replyAuthorInput = document.getElementById("replyAuthorInput");
      var replyMessageInput = document.getElementById("replyMessageInput");
      var pictureInput = document.getElementById("pictureInput");

      var name = nameInput.value.trim();
      var message = messageInput.value.trim();
      var replyAuthor = replyAuthorInput.value.trim();
      var replyMessage = replyMessageInput.value.trim();
      var picture = pictureInput.value.trim();

      if (name === "" || message === "") {
        alert("Please enter your name and message.");
        return;
      }

      addMessage(name, message, replyAuthor, replyMessage, picture);

      nameInput.value = "";
      messageInput.value = "";
      replyAuthorInput.value = "";
      replyMessageInput.value = "";
      pictureInput.value = "";
    });

    // Event listener for the filter button
    var filterButton = document.getElementById("filterButton");
    filterButton.addEventListener("click", function() {
      var nameFilterInput = document.getElementById("nameFilterInput");
      var nameFilter = nameFilterInput.value.trim().toLowerCase();

      var filteredMessages = allMessages.filter(function(message) {
        return message.name.toLowerCase().includes(nameFilter);
      });

      displayMessages(filteredMessages);
    });

    // Event listener for the download button
    var downloadButton = document.getElementById("downloadButton");
    downloadButton.addEventListener("click", function() {
      var csvContent = "data:text/csv;charset=utf-8,";
      csvContent += "Name,Date,Time,Message,Reply Author,Reply Message,Picture\n";

      allMessages.forEach(function(message) {
        csvContent += [
          message.name,
          new Date(message.timestamp).toLocaleDateString(),
          new Date(message.timestamp).toLocaleTimeString(),
          message.message,
          message.replyAuthor,
          message.replyMessage,
          message.picture
        ].join(",") + "\n";
      });

      var encodedUri = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "messages.csv");
      document.body.appendChild(link);
      link.click();
    });

    // Display all messages initially
    displayMessages(allMessages);
  </script>
</body>
</html>
